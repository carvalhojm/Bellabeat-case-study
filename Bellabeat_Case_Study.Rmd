---
title: "Bellabeat Case Study"
author: "João Carvalho"
date: "2025-06-26"
output:
  html_document: default
  pdf_document: default
---

![Bellabeat logo](https://miro.medium.com/v2/resize:fit:1200/1*SjEGKrjDp7skk4URhzW5Nw.png)

## 1. Introduction

In the capstone project of the Google Data Analytics Professional Certificate course on Coursera, a case study is presented for performing data analyst work for the fictional company Bellabeat.

- Scenario:

Bellabeat is a high-tech manufacturer of health-focused products for women. Its app and smart devices provide users with insights into their daily well-being and health, including physical activity, sleep, stress, menstrual cycle, water intake, and mindfulness habits. This data can help users better understand their current habits and make healthy decisions, including personalized guidance based on their lifestyle and goals through its membership service. 

Their products portfolio includes: 

- Bellabeat app: provides users with health data related to their activity, sleep, stress, menstrual cycle, and mindfulness habits and connects with the smart devices.
- Leaf: classic wellness tracker can be worn as a bracelet, necklace, or clip.
- Time: wellness watch.
- Spring: a water bottle that tracks daily water intake using smart technology .
- Bellabeat membership: gives users 24/7 access to fully personalized guidance.

I was asked to analyze the Fitbit dataset to find patterns and insights that could help inform decisions about Bellabeat's marketing and product strategy.

After the analysis, recommendations were presented to the company: segment customers further and identify patterns, crossing different categorizations, invest in increasing the time of use of smart devices with incentives and new features, with personalized reports and content, social and gamification elements, suggestions for tours in the users' region, and creation of tools to help customers improve their sleep.

![woman practicing physical activity](https://images.pexels.com/photos/8567597/pexels-photo-8567597.jpeg)

## 2. Ask

The cofounder and Chief Creative Officer believes that analyzing the data related to Bellabeat’s smart devices will help the company gain insights for future marketing campaigns. As a data analyst, I will analyze the historical data from the smartwatches of about 30 users over a two-month period. Through this analysis, I will be able to find user profile characteristics and usage trends that will serve as the basis for more targeted marketing campaigns and increase user identification with the brand.

## 3. Prepare 

**Data Location**: The FitBit Fitness Tracker dataset (CC0: Public Domain) will be used for this analysis, available on [Kaggle](https://www.kaggle.com/datasets/arashnic/fitbit).

**Data Organization**: The dataset was generated by approximately 30 FitBit users who responded to a distributed survey via Amazon Mechanical Turk between 03.12.2016 - 05.12.2016. It is organized into 11 and 18 tables for each month, containing comprehensive information on activity metrics, calories, steeps, BMI, heart rate and sleep records; in time frames of seconds, minutes, hours and days.

**Data Credibility & Bias**: Some data frames will not be used for analysis because there are more complete data frames with the same information, they are not consistent in the two months, there is too much information missing or the sample size is too small.

For the case study, I combined the datasets from the two months when possible to be able to analyze a larger time period. One dataset was not available in month 03, and when used, it was analyzed only in relation to the individual data from month 04, reducing the scope of the analysis.

Because the data is made available by a real technology wellness company, it is considered reliable. To maintain the anonymity of the service's customers, personal data such as customer information, age, gender, financial transactions and others are unavailable, which makes it impossible to perform deeper analyses on users, especially targeting the female audience.

Some datasets reduce the number of users by half, which is already not many, which hinders the analysis. Even so, with the objective of conducting the study, the sets were analyzed.

## 4. Process

The tool chosen to clean, analyze and visualize the data was the R programming with RStudio.

The first step was to import all the CSV tables into RStudio.

### 4.1 Installing packages and opening libraries

The following packages were used for our analysis: tidyverse, lubridate, scales, and ggpubr.

```{r}
library(tidyverse)
library(lubridate)
library(scales)
library(ggpubr)
```

### 4.2 Importing datasets

The following CSV files were imported into RStudio: dailyActivity_merged, hourlyCalories_merged, hourlySteps_merged, sleepDay_merged and weightLogInfo_merged.

The “sleepDay_merged” table is only available in month 04, so when used, it was only used with data related to that month.

```{r}
#datasets 03 month
daily_activity_03 <- read_csv("dailyActivity_merged_03.csv")
hourly_calories_03 <- read_csv("hourlyCalories_merged_03.csv")
hourly_steps_03 <- read_csv("hourlySteps_merged_03.csv")
weight_log_info_03 <- read_csv("weightLogInfo_merged_03.csv")

#datasets 04 month
daily_activity_04 <- read_csv("dailyActivity_merged_04.csv")
hourly_calories_04 <- read_csv("hourlyCalories_merged_04.csv")
hourly_steps_04 <- read_csv("hourlySteps_merged_04.csv")
sleep_day_04 <- read_csv("sleepDay_merged_04.csv")
weight_log_info_04 <- read_csv("weightLogInfo_merged_04.csv")
```

### 4.3 Merging months datasets

The first step in merging data from different months was to check whether the tables had the same column names.

```{r}
names(daily_activity_03) == names(daily_activity_04)   
names(hourly_calories_03) == names(hourly_calories_04)
names(hourly_steps_03) == names(hourly_steps_04)
names(weight_log_info_03) == names(weight_log_info_04)
```

It was also checked how many different IDs there were in each table.

```{r}
#03
n_distinct(daily_activity_03$Id)
n_distinct(hourly_calories_03$Id)
n_distinct(hourly_steps_03$Id)
n_distinct(weight_log_info_03$Id)
#04
n_distinct(daily_activity_04$Id)
n_distinct(hourly_calories_04$Id)
n_distinct(hourly_steps_04$Id)
n_distinct(weight_log_info_04$Id)
n_distinct(sleep_day_04$Id)
```

The weight tables for both months have a much lower number of users, so they will be analyzed separately from the other sets. The "sleep_day_04" table also has fewer IDs, containing only 24.

Then the tables for each month were merged into one.

```{r}
daily_activity <- bind_rows(daily_activity_03, daily_activity_04)
hourly_calories <- bind_rows(hourly_calories_03, hourly_calories_04)
hourly_steps <- bind_rows(hourly_steps_03, hourly_steps_04)
weight <- bind_rows(weight_log_info_03, weight_log_info_04)
```

Checking whether any IDs were added after the merge.

```{r}
n_distinct(daily_activity$Id)
n_distinct(hourly_calories$Id)
n_distinct(hourly_steps$Id)
n_distinct(weight$Id)
```

After the merge, the weight table has 13 users while the other datasets have 35.

### 4.4 Previewing our datasets

```{r}
colnames(daily_activity)
colnames(hourly_calories)
colnames(hourly_steps)
colnames(weight)
colnames(sleep_day_04)
```

```{r}
str(daily_activity)
str(hourly_calories)
str(hourly_steps)
str(weight)
str(sleep_day_04)
```

```{r}
head(daily_activity)
head(hourly_calories)
head(hourly_steps)
head(weight)
head(sleep_day_04)
```

The data that stand out are: total steps, level of activity, sedentary time, calories burned, weight, BMI, time in bed and time sleeping.

### 4.5 Data cleaning

Now that we know more about our data structures, let's process them to look for errors, missing values, and inconsistencies.

#### 4.5.1 Looking for duplicates

```{r}
sum(duplicated(daily_activity))
sum(duplicated(hourly_calories))
sum(duplicated(hourly_steps))
sum(duplicated(weight))
sum(duplicated(sleep_day_04))
```

#### 4.5.2 Checking results reported as duplicates

The data was checked to try to find any user or time pattern that was causing the duplicates before it was cleaned. Since no pattern was found, all data was deleted.

```{r}
hourly_calories %>% 
  filter(duplicated(.))
duplicated_hourly_calories <- hourly_calories[duplicated(hourly_calories) | duplicated(hourly_calories, fromLast = TRUE), ]
head(duplicated_hourly_calories)

hourly_steps %>% 
  filter(duplicated(.))
duplicated_hourly_steps <- hourly_steps[duplicated(hourly_steps) | duplicated(hourly_steps, fromLast = TRUE), ]
head(duplicated_hourly_steps)

sleep_day_04 %>% 
  filter(duplicated(.))
sleep_day_04[duplicated(sleep_day_04) | duplicated(sleep_day_04, fromLast = TRUE), ]
```

#### 4.5.3 Removing duplicates

```{r}
hourly_calories <- hourly_calories %>% distinct() 

hourly_steps <- hourly_steps %>% distinct() 

weight <- weight %>% distinct()

sleep_day_04 <- sleep_day_04 %>% distinct()
```

#### 4.5.4 Confirming that duplicates have been deleted

```{r}
sum(duplicated(hourly_calories))
sum(duplicated(hourly_steps))
sum(duplicated(weight))
sum(duplicated(sleep_day_04))
```

#### 4.5.5 Formatting date and time columns

Some tables had different date and time formats, these data were standardized, and for more accurate analysis of hour-by-hour data, "POSIXt" was used. The names of date columns were also standardized to facilitate future merges.

```{r}
daily_activity <- daily_activity %>% 
  rename(date = ActivityDate) %>% 
  mutate(date = as_date(date, format = "%m/%d/%Y"))

weight <- weight %>% 
  rename(date = Date) %>% 
  mutate(date = as_date(date, format = "%m/%d/%Y %I:%M:%S %p"))

hourly_calories <- hourly_calories %>% 
  rename(date = ActivityHour) %>% 
  mutate(date = as.POSIXct(date, format = "%m/%d/%Y %I:%M:%S %p"))

hourly_steps <- hourly_steps %>% 
  rename(date = ActivityHour) %>% 
  mutate(date = as.POSIXct(date, format = "%m/%d/%Y %I:%M:%S %p"))

sleep_day_04 <- sleep_day_04 %>% 
  rename(date = SleepDay) %>% 
  mutate(date = as_date(date, format = "%m/%d/%Y %I:%M:%S %p"))

daily_activity_04 <- daily_activity_04 %>% 
  rename(date = ActivityDate) %>% 
  mutate(date = as_date(date, format = "%m/%d/%Y"))
```

Checking date format

```{r}
class(daily_activity$date)
class(hourly_calories$date)
class(hourly_steps$date)
class(weight$date)
class(sleep_day_04$date)
```

#### 4.4.6 Checking if any minute asleep is greater than the time spent in bed

```{r}
sleep_day_04 %>% filter(TotalTimeInBed < TotalMinutesAsleep)
```

## 5. Analyse

The first step was to analyze the values of the table columns.

```{r}
daily_activity %>%  
  select(TotalSteps, TotalDistance, SedentaryMinutes, Calories) %>%
  summary()

hourly_calories %>%  
  select(Calories) %>%
  summary()

hourly_steps %>%  
  select(StepTotal) %>%
  summary()
```

The average number of steps per user is lower than the recommended 7,500, while the ideal for greater benefits is 10,000 steps, which suggests that most users have a more sedentary routine.

The average number of sedentary minutes is 992 minutes, or 16 and a half hours, which is more than half the time in a day, and would be interesting to reduce.

The average human calorie expenditure is around 2,000 to 3,000 per day, and can be altered by many factors, including the intensity of physical activity. This number being closer to 2,000 suggests that users practice little physical activity.

```{r}
daily_activity %>%  
  select(VeryActiveMinutes, FairlyActiveMinutes, LightlyActiveMinutes) %>%
  summary()
```

Users' sedentary minutes are up to 9 times greater than their physical activity minutes.

The minimum recommended daily exercise time for a healthy routine is around 20 minutes. With an average of 19 minutes, users are at the minimum recommended limit.

```{r}
weight %>%  
  select(WeightKg, Fat, BMI, IsManualReport) %>%
  summary()
```

The ideal BMI percentage is around 18.5 and 25, while the average user is slightly above this number, but the 3rd Qu. is still 25.59, which indicates that the overall average is good and some overweight users increase the average.

```{r}
sleep_day_04 %>%  
  select(TotalSleepRecords, TotalMinutesAsleep,  TotalTimeInBed) %>%
  summary()
```

The average number of hours of sleep is slightly less than 7 hours, at the minimum recommended limit.

### 5.1 Sorting active users by device usage

The first factor for classifying users was the number of days the smart device was used, using a valid day rule as a day with more than 100 steps recorded.

Users were grouped as follows:
- Low use - Between 1 and 20.
- Moderate use - Between 21 and 40.
- High use - Between 41 and 60.

```{r}
daily_usage <- daily_activity %>%
  filter(TotalSteps >100 ) %>% 
  group_by(Id) %>%
  summarize(ActivityDate=sum(n())) %>%
  mutate(usage_type = case_when(
    ActivityDate >= 1 & ActivityDate <= 20 ~ "Low Use",
    ActivityDate >= 21 & ActivityDate <= 40 ~ "Moderate Use", 
    ActivityDate >= 41 & ActivityDate <= 60 ~ "High Use")) %>% 
  mutate(usage_type = factor(usage_type, level = c('Low Use','Moderate Use','High Use'))) %>% 
  rename(days_used = ActivityDate) %>% 
  group_by(usage_type)

head(daily_usage)
```

For better understanding, the group values were converted into percentages.

```{r}
daily_usage_percent <- daily_usage %>%
  count(usage_type) %>% 
  ungroup() %>%    
  mutate(
    #creating new columns for user type percentages
    total_percent = n / sum(n), 
    # transforming decimal into percentage
    labels = scales::percent(total_percent)
  )

head(daily_usage_percent)
```

Most users (17) use the smart device moderately, followed by high use users with 15, a good amount but could be increased, and lastly low use with 3.

Let's convert these numbers to a pie chart. 

```{r}
ggplot(daily_usage_percent, aes(x = "", y = total_percent, fill = usage_type)) +
  geom_col(width = 11, color = "white") + 
  coord_polar(theta = "y") + 
  labs(title = "User Usage Type Percent", fill = "User usage type", x = NULL, y = NULL) + 
  theme_void() + 
  geom_text(aes(label = labels), 
            position = position_stack(vjust = 0.5), 
            size = 5, color = "black") + 
 scale_fill_manual(values = c("High Use" = "#391fea", "Moderate Use" = "#467df9", "Low Use" = "#d43b2d"))
```

The chart shows us a good usage indicator, with only 8.6% of users showing low usage. Moderate and high usage numbers are close together.

Actions such as in-app push notifications and inbound marketing can be useful to increase the number of active days.

### 5.2 Number of steps

To get an overview, let's make a graph to see the number of steps taken by users.

```{r}
#making the chart
ggplot(data = daily_activity) +
  geom_histogram(mapping = aes(x = TotalSteps), binwidth = 4000, color = "#467df9", fill = "#467df9", alpha = 0.6) + 
  geom_vline(aes(xintercept = 4500, color = "sedentary", linetype = "sedentary"), linewidth = 0.8) +
  geom_vline(aes(xintercept = 10000, color = "recommended", linetype = "recommended"), linewidth = 0.8) +
  labs(x = "daily steps", y = "count", title = "Distribution of number of steps") +
  scale_color_manual(name = "Daily Recommendation (WHO)", 
                     values = c("sedentary" = "red",
                                "recommended" = "black")) +
  scale_linetype_manual(name = "Daily Recommendation (WHO)", 
                        values = c("sedentary" = "twodash",
                                   "recommended" = "dashed")) +
  theme_minimal() 
```

According to recommendations for a healthy lifestyle, the minimum number of steps to stop being sedentary is 4,000 per day, and a considerable number do not even reach that point.

Most users do not exceed 10,000 steps per day, which would be ideal for having a healthy routine and reducing the risk of diseases.

## 5.3 Number of steps by user usage type

For a more in-depth analysis, let's segment the number of steps by the type of smart device usage.

```{r}
#merging activity and usage tables
daily_activity_usage <- daily_activity %>%
  left_join(daily_usage, by = "Id")
```

Making the same previous segmented histogram

```{r}
ggplot(data = daily_activity_usage) +
  geom_histogram(mapping = aes(x = TotalSteps), binwidth = 4000, color = "#467df9", fill = "#467df9", alpha = 0.6) +
  geom_vline(aes(xintercept = 4500, color = "sedentary", linetype = "sedentary"), linewidth = 0.8 ) +
  geom_vline(aes(xintercept = 10000, color = "recommended", linetype = "recommended"), linewidth = 0.8) +
  labs(x = "daily steps", y = "count", title = "Distribution of Daily Steps by User Usage Type") +
  scale_color_manual(name = "Daily Recommendation (WHO)",
                     values = c("sedentary" = "#d43b2d",
                                "recommended" = "black")) +
  scale_linetype_manual(name = "Daily Recommendation (WHO)",
                        values = c("sedentary" = "twodash",
                                   "recommended" = "dashed")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) + 
  theme(legend.position = "top") +
  facet_wrap(~ usage_type) 
```

High use users are the only ones who have a considerable number of steps above the recommended healthy number of steps.

Moderate use users have a constant number of steps until they reach 10 thousand, but then the values drop considerably.

Let's make a boxplot for deeper compreesion.

```{r}
daily_activity_usage %>%
  ggplot(aes(x= , y= TotalSteps, fill= usage_type)) +
  geom_boxplot() +
  scale_y_continuous(limits=c(0,40000), breaks=seq(0,40000, by = 5000))+
  labs(title= ("Average Steps by User Usage Type"), x=" " , y="Total Steps")+
  theme(plot.title = element_text(size = 16),
        axis.text.y = element_text(size=10), 
        axis.text.x = element_blank(),axis.ticks.x=element_blank(),
        legend.title = element_text(size=12),
        legend.text = element_text(size=8))+
  facet_grid(~usage_type) +
  theme_minimal() +
  scale_fill_manual(name = "Usage Type",
                    values = c("High Use" = "#391fea", "Moderate Use" = "#467df9", "Low Use" = "#d43b2d")) 
```

The average step taken increases across the usage groups.

High usage users are the only ones who have considerable values above 10 thousand steps. They are also the group that has very high values, above 35 thousand steps.

### 5.4 Grouping by number of steps

As discussed previously, there is a recommended number of steps for a healthy life. To understand the percentage of physical activity of users, the average number of steps per day will be calculated and grouped by 4 definitions of physical activity.

- Sedentary - Less than 4500 steps a day.
- Lightly active - Between 4500 and 7499 steps a day.
- Fairly active - Between 7500 and 9999 steps a day.
- Very active - More than 10000 steps a day.

The first step will be to find out the average of all types of user activity, add them up and find out the total average.

```{r}
active_average <- daily_activity %>%
  group_by(Id) %>%
  summarise (mean_daily_steps = mean(TotalSteps), mean_daily_calories = mean(Calories))

head(active_average)
```

Segmenting users by total step count

```{r}
user_active_type <- active_average %>%
  mutate(user_type = case_when(
    mean_daily_steps < 4500 ~ "sedentary",
    mean_daily_steps >= 4500 & mean_daily_steps < 7500 ~ "lightly active", 
    mean_daily_steps >= 7500 & mean_daily_steps < 10000 ~ "fairly active", 
    mean_daily_steps >= 10000 ~ "very active"
  ))

head(user_active_type)
```

For better understanding, the group values were converted into percentages.

```{r}
user_active_type_percent <- user_active_type %>%
  count(user_type) %>%
  mutate(total_percent = n / sum(n),
         labels = scales::percent(total_percent)) %>%
  mutate(user_type = factor(user_type,
                            levels = c("very active", "fairly active", "lightly active", "sedentary")))

head(user_active_type_percent)
```

The majority of users are lightly active with 11, followed by sedentary with 9, fairly active with 8 and in last place with only 7 very active users.

Let's convert these numbers to a pie chart. 

```{r}
ggplot(user_active_type_percent, aes(x = "", y = total_percent, fill = user_type)) +
  geom_col(width = 11, color = "white") +  
  coord_polar(theta = "y") + 
  labs(title = "User Active Type Percentage", fill = "User Active Type", x = NULL, y = NULL) + 
  theme_void() + 
  geom_text(aes(label = labels), 
            position = position_stack(vjust = 0.5), 
            size = 5, color = "black") + 
  scale_fill_manual(values = c("very active" = "#391fea",
                               "fairly active" = "#467df9",
                               "lightly active" = "#ab70ff",
                               "sedentary" = "#d43b2d")) 
```

Most users are lightly active, followed by sedentary and lastly very active, which indicates that most users do not practice physical activity constantly.

### 5.5  Segmenting grouped number of steps by user usage type

to have a more targeted view, the activity category will now be segmented by days used.

```{r}
#merging tables
daily_active_type_usage <- user_active_type %>%
  left_join(daily_usage, by = "Id")
```

```{r}
#converting quantity to porcentage
daily_active_use_piechart <- daily_active_type_usage %>%
  group_by(usage_type, user_type) %>%
  summarise(n_users = n(), .groups = "drop_last") %>% 
  mutate(
    total_in_facet = sum(n_users), 
    total_percent = n_users / total_in_facet, 
    labels = scales::percent(total_percent)
  ) %>%
  ungroup()

head(daily_active_use_piechart)
```

Let's make a pie chart for deeper understanding.

```{r}
ggplot(daily_active_use_piechart, aes(x = "", y = total_percent, fill = user_type)) +
  geom_col(width = 1, color = NA) + 
  coord_polar(theta = "y") + 
  labs(title = "User Active Type Distribution by Usage Group", fill = "Activity Level", x = NULL, y = NULL) + 
  theme_void() + 
  geom_text(aes(label = labels), 
            position = position_stack(vjust = 0.5), 
            size = 4, color = "black") +
  scale_fill_manual(values = c("very active" = "#391fea", "fairly active" = "#467df9", 
                               "lightly active" = "#ab70ff", "sedentary" = "#d43b2d")) +
  facet_wrap(~ usage_type) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, vjust = 4),
        legend.position = "bottom", 
        strip.text = element_text(size = 10, face = "bold")) 
```

The chart provide some insights into user activity by time spent using the smart device:

- High use group are those with the highest number of very active users, with almost half of the values.
- Moderate use group presents more than half, around 67% of users who need to perform more physical activity.
- All users with low use present sedentary behavior on the days they used the smart device.

### 5.6 Total steps vs calories

Total steeps vs calories data will be examined to identify a relationship.

```{r}
#making the chart
ggplot(data = daily_activity) + aes(x = TotalSteps, y = Calories) +
  geom_point(color = "#391fea", alpha = 0.6) +
  geom_smooth(method = 'loess', formula = 'y ~ x', color = 'darkblue') +
  labs(title = "Total Steps vs Calories", y = 'calories', x = 'total steps')
```

As expected, the data is directly related, the greater the number of steps, the greater the number of calories burned.

### 5.7 Relationship between steps and calories by time of day

The steps and calories tables will be merged to identify hour-by-hour patterns of users and their relationships.

```{r}
hourly_calories_steps <- hourly_calories %>%
  left_join(hourly_steps, by = c("Id", "date"))
```

Converting steps and calories values into averages by hour of the day.

```{r}
hourly_calories_steps_grouped <- hourly_calories_steps %>%
  mutate( hour_of_day = hour(date)) %>%
  group_by(hour_of_day) %>% 
  drop_na() %>% 
  summarize(
    average_steps = mean(StepTotal, na.rm = TRUE),
    average_calories = mean(Calories, na.rm = TRUE),
    .groups = "drop" 
  ) %>%
  arrange(hour_of_day)

head(hourly_calories_steps_grouped)
```

Let's build an hourly bar chart for better visualization and comparison.

```{r}
ggarrange(
  ggplot(data = hourly_calories_steps_grouped) +
    geom_col(aes(x = hour_of_day, y = average_steps, fill = average_steps)) + 
    labs(title = "Hourly Steps Throughout the Day", x="hour of the day", y="average steps") + 
    scale_fill_gradient(low = "#d43b2d", high = "#391fea")+
    scale_x_continuous(breaks = 0:23, 
                       labels = as.character(0:23)) + 
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
          legend.position = "bottom"), 
  ggplot(data = hourly_calories_steps_grouped) +
    geom_col(aes(x = hour_of_day, y = average_calories, fill = average_calories)) + 
    labs(title = "Hourly Calories Throughout the Day", x="hour of the day", y="average calories") + 
    scale_fill_gradient(low = "#d43b2d", high = "#391fea")+
    scale_x_continuous(breaks = 0:23, 
                       labels = as.character(0:23)) + 
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
          legend.position = "bottom") 
)
```

The charts follow very similar patterns.
From midnight to five o'clock the number of steps is close to 0, indicating that users are sleeping at these times
The **peaks** in steps and calories burned occur at **noon**, and **between five and seven o'clock at night**, indicating lunch breaks and free time after work.

### 5.8 Segmenting steps and calories by time of day and by user usage type

To have a more targeted view, steps and calories burned will now be segmented by usage days.

Let's repeat the conversion of steps and calorie values into averages by hour of day, but also using Id.

```{r}
hourly_averages_by_id_and_hour <- hourly_calories_steps %>%
  mutate(hour_of_day = hour(date)) %>% 
  group_by(Id, hour_of_day) %>% 
  drop_na() %>% 
  summarize(
    average_steps = mean(StepTotal, na.rm = TRUE),
    average_calories = mean(Calories, na.rm = TRUE),
    .groups = "drop" 
  ) %>%
  arrange(Id, hour_of_day)

head(hourly_averages_by_id_and_hour)
```

Merging with usage table.

```{r}
hourly_averages_usage <- hourly_averages_by_id_and_hour %>%
  left_join(daily_usage, by = "Id")
```

Now the total steps and calories of users will be grouped by the hours of the day.

```{r}
hourly_usage_grouped <- hourly_averages_usage %>% 
  group_by(usage_type, hour_of_day) %>% 
  summarize(
    grouped_sum_steps = sum(average_steps),
    grouped_sum_calories = sum(average_calories),
    .groups = "drop"
  )
```

Making the first bar chart of the steps by hour.

```{r}
ggplot(hourly_usage_grouped, aes(x = hour_of_day, y = grouped_sum_steps, fill = grouped_sum_steps)) +
  geom_col() +
  labs(title = "Average Steps by Hour of Day x Usage Type",
       x = "hour of day", y = "average steps") +
  scale_fill_gradient(low = "#d43b2d", high = "#391fea") +
  scale_x_continuous(breaks = 0:23, labels = as.character(0:23)) +
  facet_wrap(~ usage_type) + 
  theme_minimal() +
  theme(axis.text.x = element_text(size = 6, angle = 90, vjust = 0.5, hjust = 1),
        strip.text = element_text(face = "bold"),
        legend.position = "bottom")
```

Making the other bar chart of the calories burned per hour.

```{r}
ggplot(hourly_usage_grouped, aes(x = hour_of_day, y = grouped_sum_calories, fill = grouped_sum_calories)) +
  geom_col() +
  labs(title = "Average Calories by Hour of Day x Usage Type",
       x = "hour of day", y = "average calories") +
  scale_fill_gradient(low = "#d43b2d", high = "#391fea") +
  scale_x_continuous(breaks = 0:23, labels = as.character(0:23)) +
  facet_wrap(~ usage_type) + 
  theme_minimal() +
  theme(axis.text.x = element_text(size = 6, angle = 90, vjust = 0.5, hjust = 1),
        strip.text = element_text(face = "bold"),
        legend.position = "bottom") 
```

The charts give us some insights:
- The **low-use** group has the **lowest** number of steps recorded.
- The moderate-use group starts recording an increase in the number of steps an hour earlier than the high-use group, but the high-use group maintains a relatively higher level of activity later in the day.
- Although the high-use group engages in more activity, **the number of calories burned by the moderate group is higher, indicating a pattern of overweight**.

### 5.9 BMI levels

The data will be grouped by BMI averages to identify the weight characteristics of users.

- Underweight - Less than 18.5.
- Healthy weight - Between 18.5 and 24.9.
- Overweight - Between 25 and 29.9.
- Obese - More than 30.

This data further narrows our research with only 13 users available.

First, let's find the average BMI per user.

```{r}
weight_grouped <- weight %>%
  group_by(Id) %>%
  summarise(BMI = mean(BMI))
```

Categorizing BMI user type.

```{r}
weight_user_type <- weight_grouped %>%
  mutate(
    BMI = case_when(
      BMI < 18.5 ~ "underweight",
      BMI >= 18.5 &
        BMI < 25 ~ "healthy weight",
      BMI >= 25 &
        BMI < 30 ~ "overweight",
      BMI >= 30 ~ "obese"
    ))

head(weight_user_type)
```

Transforming floatings into percentage to improve analysis

```{r}
weight_user_type_percent <- weight_user_type %>%
  count(BMI) %>%
  mutate(total_percent = n / sum(n),
         labels = scales::percent(total_percent)) %>%
  mutate(BMI = factor(BMI, levels = c("underweight", "healthy weight", "overweight", "obese")))

head(weight_user_type_percent)
```

The majority of users are overweight with 7 users in total, followed by healthy weight with 9 users and only 2 obese users in last place. This categorization did not find any underweight users.

Let's convert these numbers to a pie chart. 

```{r}
ggplot(weight_user_type_percent, aes(x = "", y = total_percent, fill = BMI)) +
  geom_col(width = 11, color = "white") +
  coord_polar(theta = "y") + 
  labs(title = "User Weight Type Percentage", fill = "User Weight Type", x = NULL, y = NULL) + 
  theme_void() + 
  geom_text(aes(label = labels), 
            position = position_stack(vjust = 0.5), 
            size = 5, color = "black") + 
  scale_fill_manual(values = c("healthy weight" = "#391fea",
                               "underweight" = "#467df9",
                               "overweight" = "#ab70ff",
                               "obese" = "#d43b2d"))
```

Around 69% of users are overweight.
This categorization can be used as a marketing strategy to provide personalized diet and exercise tips for each group with different goals.

### 5.10 BMI levels vs usage type

For a more targeted view, BMI levels will now be segmented by days used.

```{r}
#merging tables
weight_user_type_usage <- weight_user_type %>%
  left_join(daily_usage, by = "Id") 
```

Transforming values into percentage.

```{r}
weight_user_type_usage_piechart <- weight_user_type_usage %>%
  group_by(usage_type, BMI) %>%
  summarise(n_users = n(), .groups = "drop_last") %>% 
  mutate(
    total_in_facet = sum(n_users), 
    total_percent = n_users / total_in_facet, 
    labels = scales::percent(total_percent)
  ) %>%
  ungroup()
```

Let's convert these numbers to a pie chart.

```{r}
ggplot(weight_user_type_usage_piechart, aes(x = "", y = total_percent, fill = BMI)) +
  geom_col(width = 1) + 
  coord_polar(theta = "y") + 
  labs(title = "User Active Type Distribution by Usage Group", fill = "Activity Level", x = NULL, y = NULL) + 
  theme_void() + 
  geom_text(aes(label = labels), 
            position = position_stack(vjust = 0.5), 
            color = "black", size = 4) + 
  scale_fill_manual(values = c("healthy weight" = "#391fea", "underweight" = "#467df9",
                               "overweight" = "#ab70ff", "obese" = "#d43b2d")) +
  facet_wrap(~ usage_type) + 
  theme(plot.title = element_text(size = 14, hjust = 0.5, vjust = 4),
        legend.position = "bottom", 
        strip.text = element_text(size = 10, face = "bold")) 
```

The charts give us some insights:
- High use group has the highest amount of very active, with almost half of the values.
- Moderate use group has more than half, around 67%, of users who need to perform more physical activities.
- All low use users have sedentary behaviors on the days they used the smart device.


### 5.11 BMI vs average steps

Let's analyze the relationship between the BMI number and the average number of steps. 

First, I created a table by merging the weight and activity tables.

```{r}
activity_weight_type <- weight_user_type %>%
  left_join(daily_activity, by = "Id")
```

Creating a new table to find mean steps per BMI type.

```{r}
#finding mean steps per BMI type 
activity_weight_type_plot <- activity_weight_type %>%
  group_by(BMI) %>%
  summarise(
    mean_steps = mean(TotalSteps, na.rm = TRUE),
    n_users = n_distinct(Id)
  ) 

head(activity_weight_type_plot)
```

Let's transform those values in a bar chart.

```{r}
ggplot(activity_weight_type_plot, aes(x = BMI, y = mean_steps, fill = BMI)) + #BMI x steps
  geom_col(width = 0.6) +
  labs(title = "Mean Steps per BMI user type",
       x = "CMI user type", y = "mean steps") +
  scale_fill_manual(values = c("healthy weight" = "#391fea", "underweight" = "#467df9",
                               "overweight" = "#ab70ff", "obese" = "#d43b2d")) +
  theme_minimal() +
  theme(legend.position = "none")
```

The difference in the average number of steps taken by the obese group is clear, while healthy weight and overweight groups are close to the suggested goal of 10,000 steps.


### 5.12 Exploring the sleeping time table 

To analyze users' sleep time, the relationship between sleep time and time in bed will first be explored.

For better visualization, the table will be convert minutes to hours.

```{r}
sleep_hour_04 <- sleep_day_04 %>%
  mutate(
    TotalHoursAsleep = round(sleep_day_04$TotalMinutesAsleep / 60, 1),
    TotalHoursInBed = round(sleep_day_04$TotalTimeInBed / 60, 1)
  )

head(sleep_hour_04)
```

Let's transform the values to a chart for better visualization. 

```{r}
ggplot(data = sleep_hour_04) +
  geom_point(mapping = aes(x = TotalHoursAsleep, y= TotalHoursInBed), alpha = 0.6, color = "#391fea") +
  geom_vline(aes(xintercept = 7), linetype = "solid") +
  labs(title = "Distribution of sleep records", x = 'hours asleep', y = 'hours in bed') +
  annotate("text", x = 8.2, y = 15, label = "7 hours of sleep", hjust = 0.4, vjust = 1, size = 4)
```

The chart give us some insights:
- **The average values are close to 7 hours of sleep, the minimum recommended for a healthy routine.**

- The number of hours spent in bed with a much higher difference in relation to the time spent sleeping occurs more often in hours spent sleeping less than 7 hours, and may indicate insomnia.

- Recommendations for better sleep may be useful for users who sleep little or suffer from insomnia.

To have an overview of each user's behavior, the average time spent in bed and time spent sleeping were calculated.

The discrepant values between time spent sleeping and time spent in bed may indicate the behavior of only one user. The new table will be important to validate this hypothesis.

```{r}
#grouping Id's averages
sleep_04_grouped <- sleep_hour_04 %>% 
  group_by(Id) %>%
  summarise(mean_hoursasleep = mean(TotalHoursAsleep), mean_hoursinbed = mean(TotalHoursInBed))

head(sleep_04_grouped)
```

For a deeper analysis, the table will already be unique with the usage type to see if we identify any pattern.

```{r}
sleep_usage_type_04 <- sleep_04_grouped %>% 
  left_join(daily_usage, by = "Id")
```

Let's redo the chart with the new information.

```{r}
ggplot(data = sleep_usage_type_04) + aes(x = mean_hoursasleep, y = mean_hoursinbed, , color = usage_type) +
  geom_point(alpha = 0.6, size = 7) +
  geom_vline(aes(xintercept = 7), linetype = "solid") +
  geom_smooth(method = 'loess', formula = 'y ~ x', color = 'darkblue', se = FALSE) +
  labs(title = "Distribution of sleep records", x = 'hours asleep', y = 'hours in bed') +
  annotate("text", x = 8.2, y = 15, label = "7 hours of sleep", hjust = 0.6, vjust = 1, size = 4) +
  theme(legend.position = "bottom")
```

The chart give us some insights:
- This graph shows more clearly the number of users sleeping less than the recommended 7 hours.
- It is clear that users probably suffer from insomnia, spending an average of 8 hours in bed but sleeping less than 6 hours.
- Apart from the outliers, there does not seem to be a huge difference between the usage type groups (no low usage was found in the sleep table).

### 5.13 Sedentary time vs asleep time

The daily activity and sleep day tables will be merged to identify the relationship between sedentary minutes and minutes asleep (using data from month 04 only).

```{r}
daily_activity_sleep_04 <- daily_activity_04 %>%  
  merge(sleep_hour_04, by=c ("Id", "date"))
```

```{r}
#making the chart
ggplot(data = daily_activity_sleep_04, aes(x = SedentaryMinutes, y = TotalMinutesAsleep)) +
  geom_point(color = "#391fea", alpha = 0.6) +
  geom_smooth(method = 'loess', formula = 'y ~ x', color = 'darkblue') +
  labs(title = "Sedentary Minutes vs Total Minutes Asleep", x = 'sedentary minutes', y = 'minutes asleep')
```

The fewer minutes of sedentary lifestyle, the greater the amount of minutes slept, since physical activity improves the quality of sleep.

### 5.14 How well users slept

The data will be grouped by hourly intervals to better identify users' sleep characteristics, following the following patterns:
- Sleep little - Less than 7.
- Sleep ideally - Between 7 and 9.
- Sleep a lot - More than 9.

```{r}
sleep_user_type_04 <- sleep_04_grouped %>%
  mutate(
    mean_hoursasleep = case_when(
      mean_hoursasleep < 7 ~ "sleep little",
      mean_hoursasleep >= 7 &
        mean_hoursasleep < 9 ~ "sleep ideally",
      mean_hoursasleep >= 9 ~ "sleep a lot"
    ))

head(sleep_user_type_04)
```

Transforming values into percentage.

```{r}
sleep_user_type_04_percent <- sleep_user_type_04 %>%
  count(mean_hoursasleep) %>%
  mutate(total_percent = n / sum(n),
         labels = scales::percent(total_percent)) %>%
  mutate(mean_hoursasleep = factor(mean_hoursasleep, levels = c("sleep little", "sleep ideally", "sleep a lot")))

head(sleep_user_type_04_percent)
```

```{r}
# making a pie chart
ggplot(sleep_user_type_04_percent, aes(x = "", y = total_percent, fill = mean_hoursasleep)) +
  geom_col(width = 11, color = "white") + 
  coord_polar(theta = "y") + 
  labs(title = "User Sleep Type Percentage", fill = "User Sleep Type", x = NULL, y = NULL) + 
  theme_void() + 
  geom_text(aes(label = labels), 
            position = position_stack(vjust = 0.5), 
            size = 5, color = "black") + 
  scale_fill_manual(values = c("sleep ideally" = "#391fea",
                               "sleep a lot" = "#467df9",
                               "sleep little" = "#d43b2d"))
```

Looking at the graph, it became clear that more than 50% of users do not get the ideal amount of sleep, which reinforces an opportunity for tips and services to improve sleep.

### 5.15 BMI levels vs time asleep

To continue exploring BMI levels, let's analyze the relationship between BMI vs time asleep. The operation will be the same as before, but only with data from month 04, since the time asleep table only exists in that month.

```{r}
#merging tables
sleep_weight_type_04 <- weight_user_type %>%
  left_join(sleep_hour_04, by = "Id", "date") 
```

```{r}
#finding mean minutes asleep per BMI type in 04 for chart
sleep_weight_type_04_plot <- sleep_weight_type_04 %>%
  group_by(BMI) %>%
  summarise(
    mean_sleep = mean(TotalHoursAsleep, na.rm = TRUE),
    n_users = n_distinct(Id)
  ) 

head(sleep_weight_type_04_plot)
```

Let's transform those values in a bar chart.

```{r}
ggplot(sleep_weight_type_04_plot, aes(x = BMI, y = mean_sleep, fill = BMI)) + #BMI x sleep
  geom_col(width = 0.6) +
  labs(title = "Mean Sleep Hours per BMI User Type",
       x = "BMI user type", y = "mean minutes asleep per night") +
  scale_fill_manual(values = c("healthy weight" = "#391fea", "underweight" = "#467df9",
                               "overweight" = "#ab70ff", "obese" = "#d43b2d")) +
  theme_minimal() +
  theme(legend.position = "none")
```

The different types of BMI do not seem to have major differences in sleeping time.

Only the obese group shows a slight difference with the time being slightly less than 7 hours.

### 5.16 Steps and time asleep per day of the week

The average number of steps and hours slept will be grouped by day of the week for analysis.

```{r}
#transforming date to day of the week
weekday_steps_sleep_04 <- daily_activity_sleep_04 %>%
  mutate(weekday = weekdays(date))
```

```{r}
#sorting by day of week
weekday_steps_sleep_04$weekday <- ordered(weekday_steps_sleep_04$weekday, 
                                          levels=c("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"))
```

Let's find averages by day of the week.

```{r}
weekday_mean_steps_sleep_04 <- weekday_steps_sleep_04 %>%
  group_by(weekday) %>%
  summarize (daily_steps = mean(TotalSteps), daily_sleep = mean(TotalHoursAsleep))

head(weekday_mean_steps_sleep_04)
```

Making the chart to summarize data.

```{r}
ggarrange(
  ggplot(data = weekday_mean_steps_sleep_04) +
    geom_col(aes(weekday, daily_steps), fill = "#391fea") +
    geom_hline(yintercept = 7500) +
    labs(title = "Daily steps per weekday", x= "", y = "count of steps") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1)), 
  ggplot(weekday_mean_steps_sleep_04, aes(weekday, daily_sleep)) +
    geom_col(fill = "#467df9") +
    geom_hline(yintercept = 7) +
    labs(title = "Hours asleep per weekday", x= "", y = "hours asleep") +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
)
```

The charts give us some insights:
- The day with the highest number of steps is Saturday, the first day of the weekend, while the day with the lowest is Sunday.
- Sunday and Wednesday are the days with the best sleeping hours.
- Because it is usually a day of rest, Sunday has opposite numbers of steps and sleeping time.


## 6. Insights

The Bellabeat app is a guide that empowers women in healthy habits and routines by educating and motivating them through daily app recommendations. Taking this into consideration, the insights found will be presented that can help both improve the results of the company's services and the habits of its customers.

Without gender being clear in Fitbit's data, it is difficult to apply all the insights directly to Bellabeat's female audience, but I assumed that all genders were presented and balanced in this data set.

Some parameters remain constant across all users. As recommended by health organizations, the more steps per day, the better the overall health and the more calories burned, and the less sedentary time, the better the quality of sleep.

Encouraging users to maintain at least 7,500 steps per day, explaining the benefits, would be extremely important to improve overall health. The highest number of steps shown is around noon, at lunchtime, and between 5 pm and 7 pm, after work. The days with the most physical activity recorded are Monday, Tuesday and Saturday, while the day with the least activity recorded is Sunday.

More than half of users sleep less than the minimum of 7 hours per day recommended for healthy sleep. Implementing resources to help users improve their sleep health could be an interesting opportunity for Bellabeat.

Segmenting users into different groups and cross-referencing this data helps to better understand their routine as a whole, identify common patterns and provide more targeted options for activities and tips for a healthy routine.

The group that uses the device the most has healthier lifestyles overall, with a higher percentage of very active users and healthy weights.

The longer they use the device, the more data is collected, better understanding the user's behavior and allowing for better recommendations. More research could be conducted to understand why the "Low Use" and "Moderate Use" groups are not using their devices more frequently, whether because they feel they need to use them only when they are physically active or for some other unknown reason. Applying incentives to increase the time spent using smart devices can be beneficial for both sides.

## 7. Recommendations

- Segment customers further and identify patterns, crossing different categories such as: activity level, weight and sleep time. This would allow for a better understanding of behavior and motivations, to recommend personalized tips and goals for different types of objectives, thus creating a greater connection with users, improving engagement with the brand's products and increasing the chances of them continuing to use the service.

- As we have seen, users who use the smart device more often also have better health patterns, investing in increasing this time with incentives and new features can be beneficial for both parties, since it would be possible to better understand each user to improve personal insights, thus also satisfying and increasing service time. Customized alerts based on data could be created, such as: push notifications, e-mails and reports, which monitor activity during the days of the week and provide feedback on whether the goal was reached or below, with motivational messages, to remind them to use the products. Another option would be to create gamification systems in the app, which would connect users with friends to see activities and metrics, with the possibility of collective goals, increasing engagement.

- Another interesting personalized content, aimed at improving the number of steps on Sunday, usually a day of rest, consequently improving weekly metrics, would be to recommend tips for tours and places to visit around the user's city, so as to indirectly increase the time of physical activity while they are distracted and increase the weekly average of activity.

- The sleep time of most users is at the minimum recommended sleep limit for a healthy routine. Encouraging users to monitor the quality of their sleep could be interesting to improve sleep time and strengthen the bond with the brand's products. Alerts could be created to relax before bedtime and to sleep. Identifying whether users suffer from any type of insomnia and offering tips on solutions would also increase trust and engagement with the brand's products. Other general sleep improvement tips could also include relaxing reading and podcasts, breathing techniques and mindfulness, all personalized to the user's preferences.
